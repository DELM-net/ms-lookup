<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Form with Linked Resources</title>
</head>
<body>

<h2>Dynamic Form</h2>

<form id="dynamicForm">
  <label for="catalogueSelect">Catalogue:</label>
  <select id="catalogueSelect" name="catalogue">
    <!-- Options will be dynamically added here -->
  </select><br><br>
  
  <label for="referenceInput">Reference:</label>
  <input type="text" id="referenceInput" name="reference"><br><br>
  
  <input type="submit" value="Submit">
</form>

<h2>Matching Rows</h2>

<table id="matchingRowsTable">
  <thead>
    <tr>
      <th>Catalogue Code</th>
      <th>Reference</th>
      <!-- Add more columns as needed -->
    </tr>
  </thead>
  <tbody>
    <!-- Table rows will be dynamically added here -->
  </tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  // Fetch catalogues data from URL
  fetch('https://raw.githubusercontent.com/DELM-net/ms-lookup/main/metadata/ms-catalogues.csv')
    .then(response => response.text())
    .then(data => {
      // Parse CSV data using PapaParse
      const catalogues = Papa.parse(data.trim(), { header: false }).data;

      // Populate select dropdown with catalogue options
      const select = document.getElementById('catalogueSelect');
      catalogues.forEach(catalogue => {
        const option = document.createElement('option');
        option.value = catalogue[0];
        option.textContent = catalogue[1];
        select.appendChild(option);
      });
    })
    .catch(error => {
      console.error('Error fetching catalogues:', error);
    });

  // Form submission
  document.getElementById('dynamicForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission
  
    // Get selected catalogue and reference
    const selectedCatalogue = document.getElementById('catalogueSelect').value;
    const reference = document.getElementById('referenceInput').value;
    
    // Load collection of CSV files
    fetch('https://raw.githubusercontent.com/DELM-net/ms-lookup/main/data/' + selectedCatalogue + '.csv')
      .then(response => response.text())
      .then(data => {
        // Parse CSV data using PapaParse
        const rows = Papa.parse(data.trim(), { header: false }).data;

        // Filter rows based on matching catalogue code and reference
        const matchingRows = rows.filter(row => row[0] === selectedCatalogue && row[1] === reference);

        // Populate table with matching rows
        const tableBody = document.querySelector('#matchingRowsTable tbody');
        tableBody.innerHTML = ''; // Clear previous rows
        matchingRows.forEach(rowData => {
          const row = document.createElement('tr');
          rowData.forEach(cellData => {
            const cell = document.createElement('td');
            cell.textContent = cellData;
            row.appendChild(cell);
          });
          tableBody.appendChild(row);
        });
      })
      .catch(error => {
        console.error('Error fetching CSV file:', error);
      });

    // Reset form fields
    this.reset();
  });
});
</script>

</body>
</html>
